<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PolarGaussian.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ziggurat Gaussian</a> &gt; <a href="index.source.html" class="el_package">org.cicirello.math.rand</a> &gt; <span class="el_source">PolarGaussian.java</span></div><h1>PolarGaussian.java</h1><pre class="source lang-java linenums">/*
 * Java implementation of the Polar Method
 * for generating Gaussian distributed random numbers.
 *
 * Copyright 2015, 2017-2020 Vincent A. Cicirello, &lt;https://www.cicirello.org/&gt;.
 *
 * This program is free software: you can 
 * redistribute it and/or modify it under the terms of the GNU 
 * General Public License as published by the Free Software 
 * Foundation, either version 3 of the License, or (at your 
 * option) any later version.
 *
 * This program is distributed in the hope 
 * that it will be useful, but WITHOUT ANY WARRANTY; without even 
 * the implied warranty of MERCHANTABILITY or FITNESS FOR A 
 * PARTICULAR PURPOSE.	See the GNU General Public License for more 
 * details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 */
 
package org.cicirello.math.rand;
 
import java.util.Random;
import java.util.SplittableRandom;
import java.util.concurrent.ThreadLocalRandom;

/**
 * &lt;p&gt;This class provides methods for generating pseudorandom numbers 
 * from a Gaussian distribution using the classic Polar Method. Other 
 * methods exist that are faster than Polar, and with superior statistical
 * properties over the Polar method.  One such algorithm is the Ziggurat
 * method, implemented in the {@link ZigguratGaussian} class.  The Polar method
 * implementation provided in the PolarGaussian class was originally implemented
 * as part of an experimental study comparing the effects of different Gaussian
 * algorithms on the performance of a genetic algorithm.  It is included here
 * in this repository, however, if you are looking for a fast algorithm for 
 * generating Gaussian distributed random numbers, we suggest you consider
 * the {@link ZigguratGaussian} class instead.&lt;/p&gt;
 *
 * &lt;p&gt;It should be noted that the Java API includes a polar method implementation
 * in both the {@link Random} and {@link ThreadLocalRandom} classes.  However, the
 * experimental study mentioned above also included the use of {@link SplittableRandom}
 * which does not provide any methods for generating Gaussian distributed random numbers.
 * The {@link SplittableRandom} class is also declared final, so extending to add 
 * such a method was not an option.  Our solution was a static method in this
 * class with a parameter for the underlying pseudorandom number generator (PRNG).
 * We chose to do the same for {@link Random} and {@link ThreadLocalRandom} so that 
 * our approach was consistent across all 3 PRNGs used in the study.&lt;/p&gt;
 *
 * &lt;p&gt;You can find some experimental data comparing the performance of a sequential
 * genetic algorithm (GA) using this implementation of the Polar method for
 * Gaussian mutation vs using the faster Ziggurat method, as well as experimental data
 * for the same comparison but with a Parallel GA, in the following paper:&lt;/p&gt;
 * &lt;ul&gt;
 * &lt;li&gt;V. A. Cicirello. 
 * &lt;a href=https://www.cicirello.org/publications/cicirello2018flairs.html target=_top&gt;Impact of 
 * Random Number Generation on Parallel Genetic Algorithms&lt;/a&gt;. Proceedings of the Thirty-First 
 * International Florida Artificial Intelligence Research Society Conference, pages 2-7. 
 * AAAI Press, May 2018.&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * @author &lt;a href=https://www.cicirello.org/ target=_top&gt;Vincent A. Cicirello&lt;/a&gt;, 
 * &lt;a href=https://www.cicirello.org/ target=_top&gt;https://www.cicirello.org/&lt;/a&gt;
 * @version 8.15.2019
 */
public final class PolarGaussian {
	
	/*
	 * Used to hold the second of the pair of Gaussian values.  Every other
	 * call to nextGaussian (by a thread) uses the value stored here.
	 */
<span class="fc" id="L75">	private static final ThreadLocal&lt;Double&gt; nextG = new ThreadLocal&lt;Double&gt;();</span>
	
	/* 
	 * Utility class with nothing but static methods, 
	 * so constructor is private to prevent instantiation.
	 */
	private PolarGaussian() {}
		
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation, sigma, or your choosing.
	 * {@link ThreadLocalRandom} is used as the pseudorandom number generator for the 
	 * source of randomness.
	 * @param sigma The standard deviation of the Gaussian.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation sigma.
	 */
	public static double nextGaussian(double sigma) {
<span class="fc" id="L93">		return sigma * nextGaussian(ThreadLocalRandom.current());</span>
	}
	
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation, sigma, or your choosing.
	 * @param sigma The standard deviation of the Gaussian.
	 * @param r The pseudorandom number generator to use for the 
	 * source of randomness.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation sigma.
	 */
	public static double nextGaussian(double sigma, Random r) {
<span class="fc" id="L106">		return sigma * nextGaussian(r);</span>
	}
	
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation, sigma, or your choosing.
	 * @param sigma The standard deviation of the Gaussian.
	 * @param r The pseudorandom number generator to use for the 
	 * source of randomness.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation sigma.
	 */
	public static double nextGaussian(double sigma, SplittableRandom r) {
<span class="fc" id="L119">		return sigma * nextGaussian(r);</span>
	}
	
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation 1.
	 * {@link ThreadLocalRandom} is used as the pseudorandom number generator for the 
	 * source of randomness.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation 1.
	 */
	public static double nextGaussian() {
<span class="fc" id="L131">		return nextGaussian(ThreadLocalRandom.current());</span>
	}
	
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation 1.
	 * @param r The pseudorandom number generator to use for the 
	 * source of randomness.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation 1.
	 */
	public static double nextGaussian(Random r) {
<span class="fc" id="L143">		Double next = nextG.get();</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">		if (next != null) {</span>
<span class="fc" id="L145">			nextG.set(null);</span>
<span class="fc" id="L146">			return next;</span>
		} else {
<span class="fc" id="L148">			double v1 = 0;</span>
<span class="fc" id="L149">			double v2 = 0; </span>
<span class="fc" id="L150">			double s = 0;</span>
<span class="fc bfc" id="L151" title="All 4 branches covered.">			while (s &gt;= 1 || s == 0) {</span>
<span class="fc" id="L152">				v1 = 2 * r.nextDouble() - 1; </span>
<span class="fc" id="L153">				v2 = 2 * r.nextDouble() - 1; </span>
<span class="fc" id="L154">				s = v1 * v1 + v2 * v2;</span>
			}
<span class="fc" id="L156">			double m = StrictMath.sqrt(-2 * StrictMath.log(s)/s);</span>
<span class="fc" id="L157">			nextG.set(v2 * m);</span>
<span class="fc" id="L158">			return v1 * m;</span>
		}
	}
	
	/**
	 * Generates a random number from a Gaussian distribution with
	 * mean 0 and standard deviation 1.
	 * @param r The pseudorandom number generator to use for the 
	 * source of randomness.
	 * @return A random number from a Gaussian distribution with mean 0 and
	 * standard deviation 1.
	 */
	public static double nextGaussian(SplittableRandom r) {
<span class="fc" id="L171">		Double next = nextG.get();</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">		if (next != null) {</span>
<span class="fc" id="L173">			nextG.set(null);</span>
<span class="fc" id="L174">			return next;</span>
		} else {
<span class="fc" id="L176">			double v1 = 0;</span>
<span class="fc" id="L177">			double v2 = 0; </span>
<span class="fc" id="L178">			double s = 0;</span>
<span class="fc bfc" id="L179" title="All 4 branches covered.">			while (s &gt;= 1 || s == 0) {</span>
<span class="fc" id="L180">				v1 = 2 * r.nextDouble() - 1; </span>
<span class="fc" id="L181">				v2 = 2 * r.nextDouble() - 1; </span>
<span class="fc" id="L182">				s = v1 * v1 + v2 * v2;</span>
			}
<span class="fc" id="L184">			double m = StrictMath.sqrt(-2 * StrictMath.log(s)/s);</span>
<span class="fc" id="L185">			nextG.set(v2 * m);</span>
<span class="fc" id="L186">			return v1 * m;</span>
		}
	}
}	
 


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>